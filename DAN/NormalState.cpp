//===================================================================================================================================
//ÅyNormalState.cppÅz
// [çÏê¨é“]HALìåãûGP12A332 11 êõñÏ é˜
// [çÏê¨ì˙]2019/11/17
// [çXêVì˙]2019/11/24
//===================================================================================================================================

//===================================================================================================================================
//ÅyÉCÉìÉNÉãÅ[ÉhÅz
//===================================================================================================================================
#include "NormalState.h"
#include "VisionState.h"
#include "SkyVisionState.h"

//===================================================================================================================================
//ÅyusingêÈåæÅz
//===================================================================================================================================
using namespace playerNS;
using namespace normalNS;

//===================================================================================================================================
//ÅyÉRÉìÉXÉgÉâÉNÉ^Åz
//===================================================================================================================================
NormalState::NormalState(Player* player) :AbstractState()
{
	this->player = player;
	type		= NORMAL;
	nextType	= NORMAL;
	stateName	= "NORMAL";
	onTrans = false;
	player->setValidOperation(
		ENABLE_MOVE | 
		ENABLE_SHOT | 
		ENABLE_JUMP | 
		ENABLE_SKY_VISION |  
		ENABLE_VISION);
}

//===================================================================================================================================
//ÅyäJénèàóùÅz
//===================================================================================================================================
void NormalState::start()
{

}

//===================================================================================================================================
//ÅyçXêVÅz
//===================================================================================================================================
void NormalState::update(float frameTime)
{
	this->frameTime = frameTime;
	if (player->vision())			return;	//ÉrÉWÉáÉì
	else if(player->skyVision())	return;	//ÉXÉJÉCÉrÉWÉáÉì
}

//===================================================================================================================================
//ÅyëÄçÏÅz
//===================================================================================================================================
void NormalState::operation()
{
	// ëÄçÏ
	player->shot();						//íeÇÃî≠éÀ
	player->moveOperation();			// à⁄ìÆëÄçÏ
	player->jumpOperation();			// ÉWÉÉÉìÉvëÄçÏ
}

//===================================================================================================================================
//Åyï®óùèàóùÅz
//===================================================================================================================================
void NormalState::physics()
{
	player->physicalBehavior();			// ï®óùãììÆ
	player->grounding();				// ê⁄ínèàóù
	player->updatePhysics(frameTime);	// ï®óùÇÃçXêV
}

//===================================================================================================================================
//ÅyÉJÉÅÉâëÄçÏÅz
//===================================================================================================================================
void NormalState::controlCamera()
{
	//ÉJÉÅÉâëJà⁄
	player->transitionCamera();
	//ÉJÉÅÉâëÄçÏ
	player->controlCamera(frameTime);
}

//===================================================================================================================================
//ÅyèÛë‘ëJà⁄Åz
//===================================================================================================================================
AbstractState* NormalState::transition()
{
	switch (nextType)
	{
	case VISION:
		return new visionNS::VisionState(player);	break;
	case SKY_VISION:
		return new skyVisionNS::SkyVisionState(player);	break;
	default:
		return new NormalState(player); break;
	}
}

//===================================================================================================================================
//ÅyèIóπèàóùÅz
//===================================================================================================================================
void NormalState::end()
{

}

